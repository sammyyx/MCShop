<template>
  <div class="wrapper">  
    <div class="upper">
      <text class='but' onclick="onshoppinglistclick">{{itemNumInSp}}</text>
      <input 
        class="searchBar" 
        id="searchBar" 
        type="text"
        autofocus="true"
        placeholder="input item name or id"
        value={{searchbarInputTxt}}
        oninput="searchBarInput"
      >
      </input>
      <text class='but' onclick="searchButClick">search</text>
    </div>
    <scroller class="lower" id="lower">
       <mc-item-one-line repeat="{{row}}" row="{{data}}"></mc-item-one-line>
    </scroller>
  </div>
</template>

<style>
.searchBar {
  border-left: 5px;
  border-right: 5px;
  border-style: solid;
  border-left-style: solid;
  border-right-style: solid;  
  flex: 3;
}

.upper {
  flex-direction: row;
  flex: 1;
}

.but {
  flex: 1;
  text-align: center;
  font-size: 35;

}

.lower {
  flex: 10;
}

.wrapper {

}
</style>

<script>
  require('./components/mc-item-one-line.we');
  var sqliteModules = require('@weex-module/sqlitemodule');
  var navigator = require('@weex-module/navigator');
  var modal = require('@weex-module/modal');
  module.exports = {
    data: {
      row: [
      ],
      itemNumInSp: 0,
      searchbarInputTxt:''
    },
    created: function() {
      var self = this;
      sqliteModules.getAllEntriesFromTableItems(
        function(list) {
          for(var i = 0; i < list.length;) {
            var column = new Object();
            column.data = new Array();
            for(var j = 0; j < 4; j++) {
              var item = new Object();
              item.id = list[i].id;
              item.name = list[i].name;
              item.icon = list[i].icon;
              column.data.push(item);
              i++;
              if (i >= list.length) {
                self.row.push(column);
                break;
              }
              if (j == 3) {
                self.row.push(column);
              }
            }
          }
        }
      )
      this.$on("additem2shoppinglist", function(e) {
        sqliteModules.showItemNumberInShoppingList(function(res) {
          self.itemNumInSp = res;
        });
      });
    },
    methods: {
      onshoppinglistclick: function(e) {
        var params = {
          'url': "file://assets/weex/pages/mc-splist.js",
          'animated': 'true'
        };
        navigator.push(params, function(e) {
        });
      },
      searchBarInput:function (e) {
        this.searchbarInputTxt = e.value;
      },
      searchButClick:function(e){
        var txt = this.searchbarInputTxt;
        //modal.toast({'message': txt, 'duration': 1});
        var params = {
        'url': "file://assets/weex/pages/mc-np.js?nitem=" + this.added_item+"&searchtxt="+txt,
        'animated': 'true'
        };
        navigator.push(params, function(e) {
        });

      }
    }
  }
</script>
